# 邀请码系统使用说明

## 📋 系统概述

本项目已集成邀请码变现系统，用户需要输入有效的邀请码才能使用性压抑指数计算器。管理员可以通过后台管理系统生成、管理和监控邀请码的使用情况。

---

## 🚀 快速开始

### 1. 初次使用 - 创建管理员账户

首次运行项目时，需要创建管理员账户：

1. 启动项目：`npm run dev`
2. 访问管理后台：http://localhost:3000/admin/login
3. 系统会自动检测到没有管理员，进入初始化模式
4. 设置管理员用户名和密码（密码至少6位）
5. 创建成功后会自动登录到管理后台

**⚠️ 重要提示：请妥善保管管理员账户，首个创建的账户会成为超级管理员。**

---

## 👨‍💼 管理后台功能

### 访问管理后台

- 地址：`/admin/login`
- 登录后会话有效期：24小时

### 管理后台主要功能

#### 📊 统计面板
- **总邀请码**：显示系统中所有邀请码数量
- **激活中**：当前可用的邀请码数量
- **总使用次数**：所有邀请码被使用的总次数
- **已用完**：达到使用上限的邀请码数量

#### 🔑 创建邀请码

点击"创建邀请码"按钮，配置以下参数：

1. **邀请码类型**
   - **单次使用**：只能使用1次，用完即失效
   - **多次使用**：可配置使用次数（如10次、50次）
   - **无限使用**：永久有效，不限使用次数

2. **生成数量**
   - 一次可批量生成1-100个邀请码
   - 适合批量分发场景

3. **有效期**
   - 设置0为永久有效
   - 设置天数（如7天、30天）后自动过期

4. **备注**（可选）
   - 为邀请码添加说明，方便管理
   - 例如："给VIP用户"、"推广活动"等

**示例配置：**
```
类型：多次使用
最大使用次数：10
生成数量：5
有效期：30天
备注：2024年1月推广活动
```

#### 📋 邀请码管理

邀请码列表显示所有邀请码的详细信息：

| 字段 | 说明 |
|------|------|
| 邀请码 | 12位大写字母+数字组合 |
| 类型 | 单次/多次/无限 |
| 使用情况 | 已使用/最大次数 |
| 状态 | 激活/已用/过期/禁用 |
| 创建时间 | 邀请码生成时间 |
| 过期时间 | 有效期截止时间 |
| 备注 | 管理员备注信息 |

**可执行操作：**
- 👁️ **查看详情**：查看邀请码的使用记录
- 🚫 **禁用**：临时禁用邀请码（可重新启用）
- ✅ **启用**：重新激活已禁用的邀请码
- 🗑️ **删除**：永久删除邀请码（不可恢复）

#### 📥 导出数据

点击"导出CSV"按钮可导出所有邀请码数据，包括：
- 邀请码
- 使用情况
- 状态信息
- 创建和过期时间

导出文件可用Excel打开，方便数据分析和备份。

---

## 👤 用户使用流程

### 用户端访问流程

```
首页 → 点击"开始测评" → 邀请码输入页 → 输入邀请码 → 验证成功 → 开始测评
```

### 邀请码验证

1. **首次访问**
   - 用户访问首页会看到提示："使用本工具需要邀请码"
   - 点击任何测评按钮会跳转到邀请码输入页

2. **输入邀请码**
   - 在输入框中输入12位邀请码
   - 邀请码不区分大小写，系统会自动转换为大写
   - 点击"验证邀请码"按钮

3. **验证结果**
   - ✅ **成功**：跳转回首页，显示成功提示，可以开始使用
   - ❌ **失败**：显示错误原因（不存在/已失效/已过期/已用完）

4. **持久化存储**
   - 验证成功后，邀请码会保存在浏览器本地
   - 下次访问无需重新输入
   - 清除浏览器数据会删除邀请码记录

---

## 💡 邀请码状态详解

### 状态说明

| 状态 | 说明 | 颜色 |
|------|------|------|
| 激活 | 正常可用 | 🟢 绿色 |
| 已用完 | 达到使用上限 | ⚪ 灰色 |
| 已过期 | 超过有效期 | 🟡 黄色 |
| 已禁用 | 管理员手动禁用 | 🔴 红色 |

### 状态转换

```
创建 → 激活
      ↓
   使用中
      ↓
   ├─→ 已用完（达到上限）
   ├─→ 已过期（超过时间）
   └─→ 已禁用（管理员操作）
```

---

## 🔧 技术实现

### 数据存储

**管理后台数据（localStorage）**
```
key: sri_admin_data
包含：
- inviteCodes: 所有邀请码
- usages: 使用记录
- admins: 管理员账户
```

**用户邀请码（localStorage）**
```
key: sri_user_invite_code
存储：用户当前使用的邀请码
```

**管理员会话（sessionStorage）**
```
key: sri_admin_session
包含：
- adminId: 管理员ID
- username: 用户名
- role: 角色
- expiresAt: 过期时间
```

### 核心API

```typescript
// 邀请码验证
validateInviteCode(code: string): InviteCodeValidation

// 使用邀请码（记录使用）
useInviteCode(code: string, sessionId: string): boolean

// 检查用户是否有有效邀请码
hasValidUserInviteCode(): boolean

// 创建邀请码
createInviteCode(options: InviteCodeGenerateOptions): InviteCode

// 批量创建
batchCreateInviteCodes(count: number, options): InviteCode[]

// 更新状态
updateInviteCodeStatus(codeId: string, status: string): boolean

// 管理员登录
adminLogin(username: string, password: string): AdminUser | null
```

---

## 🎯 使用场景

### 场景1：付费用户
```
1. 用户购买服务
2. 管理员生成单次邀请码发给用户
3. 用户输入邀请码使用工具
4. 使用后邀请码自动失效
```

### 场景2：会员制
```
1. 设置月会员、年会员等
2. 创建多次使用邀请码（30次/365次）
3. 设置对应有效期（30天/365天）
4. 会员在有效期内可多次使用
```

### 场景3：推广活动
```
1. 批量生成100个邀请码
2. 设置有效期7天
3. 通过社交媒体分发
4. 后台监控使用情况
```

### 场景4：企业团购
```
1. 创建无限使用邀请码
2. 发给企业HR
3. 企业内部员工共用
4. 可随时禁用/启用
```

---

## 🔒 安全建议

### 管理员账户安全
- ✅ 使用强密码（建议12位以上，包含大小写字母、数字、符号）
- ✅ 不要将管理员账户分享给他人
- ✅ 定期修改密码（功能待开发）
- ✅ 注意浏览器自动填充可能泄露密码

### 邀请码管理
- ✅ 定期清理过期和已用完的邀请码
- ✅ 为不同场景使用不同的备注标识
- ✅ 发现异常使用立即禁用相关邀请码
- ✅ 导出数据定期备份

### 数据安全
- ⚠️ **重要**：当前密码使用简单Base64编码存储，生产环境建议使用bcrypt等加密算法
- ⚠️ 所有数据存储在浏览器localStorage，清除浏览器数据会导致数据丢失
- ⚠️ 建议定期导出邀请码数据作为备份

---

## 🐛 常见问题

### Q1: 忘记管理员密码怎么办？
**A:** 目前没有找回密码功能，需要清除浏览器localStorage中的`sri_admin_data`，然后重新创建管理员账户。注意：这会清除所有邀请码数据！

### Q2: 用户说邀请码无效，但我看后台显示是激活状态？
**A:** 检查以下几点：
1. 邀请码是否已达使用上限
2. 邀请码是否已过期（过期时间）
3. 用户输入的邀请码是否正确（注意0和O、1和I等）
4. 刷新管理后台查看最新状态

### Q3: 如何迁移到新设备或新浏览器？
**A:**
1. 在旧设备导出邀请码CSV
2. 在新设备创建管理员
3. 手动重新创建邀请码（需要开发导入功能）

### Q4: 用户清除了浏览器数据，还能使用之前的邀请码吗？
**A:** 可以！邀请码数据存储在管理后台，只要邀请码本身有效（未达上限、未过期、未禁用），用户重新输入即可继续使用。

### Q5: 多个用户可以共用一个邀请码吗？
**A:** 可以，取决于邀请码类型：
- 单次使用：第一个用户使用后失效
- 多次使用：可以多人共用，直到达到次数上限
- 无限使用：可以无限次共用

---

## 📦 部署注意事项

### Cloudflare Pages部署
由于使用localStorage存储数据，部署到Cloudflare Pages没有问题。但注意：
- 每个管理员浏览器有独立的数据
- 建议指定一个管理员设备作为主管理端
- 其他管理员登录后看到的是空数据

### 生产环境建议
如果要用于生产环境，强烈建议：
1. 使用真实的后端数据库（如Supabase、Firebase）
2. 实现bcrypt密码加密
3. 添加邀请码导入/导出功能
4. 实现多管理员协同
5. 添加操作日志
6. 实现邀请码购买和支付接口

---

## 🎨 自定义配置

### 修改邀请码长度
编辑 `src/lib/invite-code/index.ts`：
```typescript
generateRandomCode(length: number = 12, prefix?: string)
// 将12改为你想要的长度
```

### 修改会话有效期
编辑 `src/pages/admin/login.tsx` 和 `src/pages/admin/dashboard.tsx`：
```typescript
expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000) // 24小时
// 修改24为你想要的小时数
```

### 自定义邀请码前缀
在创建邀请码时使用prefix参数：
```typescript
createInviteCode({
  type: 'single',
  prefix: 'VIP-' // 邀请码会以VIP-开头
})
```

---

## 📚 相关文件

```
src/
├── types/
│   └── invite-code.ts          # 邀请码类型定义
├── lib/
│   └── invite-code/
│       └── index.ts             # 邀请码核心功能
├── pages/
│   ├── invite-code.tsx          # 用户邀请码输入页
│   ├── home.tsx                 # 首页（集成邀请码验证）
│   └── admin/
│       ├── login.tsx            # 管理后台登录
│       └── dashboard.tsx        # 管理后台主页
└── App.tsx                      # 路由配置
```

---

## 🚀 路由说明

| 路由 | 页面 | 说明 |
|------|------|------|
| `/` | 首页 | 显示邀请码状态提示 |
| `/invite` | 邀请码输入 | 用户输入邀请码 |
| `/admin/login` | 管理员登录 | 管理员登录/初始化 |
| `/admin/dashboard` | 管理后台 | 邀请码管理界面 |
| `/assessment` | 评估页面 | 需要有效邀请码 |

---

## ✅ 功能清单

- [x] 邀请码生成（单次/多次/无限）
- [x] 邀请码验证
- [x] 使用次数限制
- [x] 有效期限制
- [x] 管理员登录系统
- [x] 管理后台界面
- [x] 邀请码状态管理
- [x] 使用记录追踪
- [x] 数据导出（CSV）
- [x] 统计面板
- [x] 批量生成邀请码
- [ ] 密码找回功能（待开发）
- [ ] 数据导入功能（待开发）
- [ ] 后端数据库集成（待开发）
- [ ] 支付接口集成（待开发）

---

## 📧 支持

如有问题，请查看代码注释或联系开发者。

**祝您使用愉快！** 🎉
